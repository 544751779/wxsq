/*! weixinwall 2017-07-06 */

function findUserByID(a,b){if($.isArray(b)){for(var c=b.length;c--;)if(b[c].mid==a)return c;return-1}return-1}function mess(a){for(var b,c,d,e=Math.floor,f=Math.random,g=a.length,h=e(g/2)+1;h--;)b=e(f()*g),c=e(f()*g),b!==c&&(d=a[b],a[b]=a[c],a[c]=d);return a}function RndRank(){mess(rankTopTen)}function gameTick(){$.each(RanksPosition,function(a,b){var c=b+PlayStep;(0==a||c<RanksPosition[a-1]-3*size/4)&&(RanksPosition[a]=c)}),setTopLeft()}function setTopLeft(){$(".tracklist .player").each(function(){var a=$(this);findUserByID(a.attr("uid"),rankTopTen)<0&&a.remove().removeClass("rotateout")}),$.each(rankTopTen,function(a,b){var c=b.mid;if($(".player.player"+c).attr("uid")!=c){if(Players[c]){if(Players[c].$elm)audio_Outride&&audio_Outride.play();else{var d=Players[c].$elm=$PlayeSeed.clone().addClass("player"+c).attr("uid",c);d.find(".head").css({"background-image":"url("+rankTopTen[a].avatar+")"}).addClass("shake"),d.find(".nickname").html(rankTopTen[a].nick_name),audio_NewPlayer&&audio_NewPlayer.play()}var e=RanksPosition[a]-2*size;e<0&&(e=0),Players[c].$elm.css({left:e,top:lineHeight*a+diff}).appendTo(".tracklist")}}else $(".player.player"+c).css({left:RanksPosition[a],top:lineHeight*a+diff})})}function showGameResult(){var a=$(".result-layer").show(),b=$(".result-label",a).show().addClass("pulse"),c=$(".result-cup",a).hide(),d=ROUNDS_LIST[CURR_ROUND].pnum;audio_Gameover&&audio_Gameover.play(),d<=3&&!rankTopTen[3]?$(".button.allresult",c).hide():$(".button.allresult",c).show(),CURR_ROUND<ROUND_COUNT-1?$(".button.nexttound").show():$(".button.nexttound").hide(),window.setTimeout(function(){b.fadeOut(function(){c.show(function(){d>=1&&rankTopTen[0]&&window.setTimeout(function(){var a=$PlayeSeed.clone().addClass("result").css({left:"50%","margin-left":"-65px",width:"160px",height:"160px",bottom:"150px"});a.find(".head").css({"background-image":"url("+rankTopTen[0].avatar+")"}).addClass("shake"),a.find(".nickname").html(rankTopTen[0].nick_name),a.appendTo(c).addClass("bounce")},800),d>=2&&rankTopTen[1]&&window.setTimeout(function(){var a=$PlayeSeed.clone().addClass("result").css({left:"40px",width:"100px",height:"100px",bottom:"120px"});a.find(".head").css({"background-image":"url("+rankTopTen[1].avatar+")"}).addClass("shake"),a.find(".nickname").html(rankTopTen[1].nick_name),a.appendTo(c).addClass("bounce")},1800),d>=3&&rankTopTen[2]&&window.setTimeout(function(){var a=$PlayeSeed.clone().addClass("result").css({right:"30px",width:"70px",height:"70px",bottom:"100px"});a.find(".head").css({"background-image":"url("+rankTopTen[2].avatar+")"}).addClass("shake"),a.find(".nickname").html(rankTopTen[2].nick_name),a.appendTo(c).addClass("bounce")},2800)})}).removeClass("pulse")},1e3)}function createTrack(){for(var a="",b=0;b<SHAKE_LINE;b++)a+='<div class="trackline"><div class="track-start">'+(b+1)+'</div><div class="track-end"></div></div>';$(a).appendTo(".Track .tracklist").hide().each(function(a){var b=$(this);window.setTimeout(function(){b.show().addClass("leftfadein")},100*a)})}function showScore(a){var b=PATH_ACTIVITY+Path_url("shake_result.php")+"?roundno="+CURR_ROUND;$.showPage(b)}function showSlogan(){$(".Panel.Top").css({top:"-"+$(".Panel.Top").height()+"px"}),$(".Panel.Bottom").css({bottom:"-"+$(".Panel.Bottom").height()+"px"});var a=$.isArray(SHAKE_INFO.slogan_list)&&SHAKE_INFO.slogan_list.length>0?SHAKE_INFO.slogan_list:["再大力！","再大力,再大力！","再大力,再大力,再大力！","摇，大力摇","快点摇啊，别停！","摇啊，摇啊，摇啊","小心手机，别飞出去伤到花花草草","看灰机～～～"],b=a.length,c=$(".Panel.SloganList").css({top:"-15%"}).show();c.css({top:0,"line-height":c.height()+"px"}),tmr_slogan=window.setInterval(function(){c.html(a[Math.floor(Math.random()*b)])},1e3)}function hideSlogan(){window.clearInterval(tmr_slogan),$(".Panel.SloganList").hide(),$(".Panel.Top").css({top:0}),$(".Panel.Bottom").css({bottom:0})}function resethd(){for(i=0;i<10;i++)$("#tx"+i).attr("src",WEB_URL+"images/shake/touxiang.jpg"),$("#nc"+i).html(""),$("#ph"+i).animate({width:"0%"}),$("#pxh"+i).animate({width:"0%"})}var rankTopTen=[],RanksPosition=[],Players={},audio_CutdownPlayer,audio_NewPlayer,audio_Outride,audio_Gameover;!function(a){for(var b=0,c=["ms","moz","webkit","o"],d=0;d<c.length&&!a.requestAnimationFrame;++d)a.requestAnimationFrame=a[c[d]+"RequestAnimationFrame"],a.cancelAnimationFrame=a[c[d]+"CancelAnimationFrame"]||a[c[d]+"CancelRequestAnimationFrame"];a.requestAnimationFrame||(a.requestAnimationFrame=function(c,d){var e=(new Date).getTime(),f=Math.max(0,16-(e-b)),g=a.setTimeout(function(){c(e+f)},f);return b=e+f,g}),a.cancelAnimationFrame||(a.cancelAnimationFrame=function(a){clearTimeout(a)})}(window),function(a){a.GameTimer=function(a,b){this.__fn=a,this.__timeout=b,this.__running=!1,this.__lastTime=Date.now(),this.__stopcallback=null},a.GameTimer.prototype.__runer=function(){Date.now()-this.__lastTime>=this.__timeout&&(this.__lastTime=Date.now(),this.__fn.call(this)),this.__running?a.requestAnimationFrame(this.__runer.bind(this)):"function"==typeof this.__stopcallback&&a.setTimeout(this.__stopcallback,100)},a.GameTimer.prototype.start=function(){this.__running=!0,this.__runer()},a.GameTimer.prototype.stop=function(a){this.__running=!1,this.__stopcallback=a}}(window);var tick=1e3,LineLength=$(window).width(),PlayStep=16,flgGameStop=!1,mainTick=new GameTimer(function(){if($.each(RanksPosition,function(a,b){var c=b+PlayStep;(0==a||c<RanksPosition[a-1]-3*size/4)&&(RanksPosition[a]=c)}),setTopLeft(),flgGameStop){window.clearTimeout(tmr_GameDataLoad),mainTick.stop();for(var a=$(".tracklist").width()-size+diff,b=0;b<RanksPosition.length;b++)RanksPosition[b]=a;setTopLeft()}},tick),tmr_GameDataLoad,gameTimeRun=function(){$.getJSON(PATH_ACTIVITY+Path_url("ajax_act_shake.php?action=working"),{roundno:CURR_ROUND},function(a){if(0==a.errno&&a.data){if($.isArray(a.data)){rankTopTen=a.data.slice(0,SHAKE_LINE);var b,c=rankTopTen.length;for(i=0;i<c;i++)i<3&&rankTopTen[i].progress>=100?$("#tx"+i).attr("src",WEB_URL+"images/shake/p"+i+".jpg"):$("#tx"+i).attr("src",rankTopTen[i].avatar),$("#nc"+i).html(rankTopTen[i].nick_name),$("#ph"+i).animate({width:rankTopTen[i].progress+"%"}),0==window.paomatype&&(b=i+2,11==b&&(b=2),$("#ph"+i).css("background","url("+WEB_URL+"images/shake/ma"+b+".png) no-repeat right center")),$("#pxh"+i).animate({width:rankTopTen[i].progress+"%"})}if(4==a.status){window.clearInterval(tmr_GameDataLoad);for(var d=$(".tracklist").width()-size+diff,e=0;e<RanksPosition.length;e++)RanksPosition[e]=d;window.setTimeout(function(){showGameResult(),hideSlogan()},660)}}})},$PlayeSeed,lineHeight,diff=10,size,resizePart=window.WBActivity.resize=function(){var a=$(".Panel.Track"),b=a.find(".tracklist").children();size=lineHeight=a.height()/SHAKE_LINE,roundLength=$(".Panel.Track .tracklist").width()-size,b.each(function(){$(this).css({height:size,"line-height":size+"px","font-size":3*size/5+"px"}).find(".track-start,.track-end").css({width:size+"px",height:size+"px"})}),$PlayeSeed=$('<div class="player"><div class="head"></div><div class="nickname"></div></div>').css({width:size-2*diff,height:size-2*diff})},start=window.WBActivity.start=function(){window.WBActivity.hideLoading();var a=document.getElementById("Audio_CutdownPlayer");a.play&&(audio_CutdownPlayer=a);var b=document.getElementById("Audio_NewPlayer");b.play&&(audio_NewPlayer=b);var c=document.getElementById("Audio_Outride");c.play&&(audio_Outride=c);var d=document.getElementById("Audio_Gameover");d.play&&(audio_Gameover=d),$(".Panel.Top").css({top:0}),$(".Panel.Bottom").css({bottom:0}),$(".Panel.Track").css({display:"block",opacity:1}),createTrack(),resizePart(),window.setTimeout(function(){nextRound()},2e3),$(".round-welcome .button-start").on("click",function(){$(".round-welcome").slideUp(function(){cutdown_start()})}),$(".button.nexttound").on("click",function(){CURR_ROUND++,CURR_ROUND_ID=ROUNDS_LIST[CURR_ROUND].id,nextRound()}),$(".button.allresult").on("click",function(){showScore(CURR_ROUND_ID)}),$(".button.reset").on("click",function(){confirm("重玩本轮会导致本轮成绩作废并清空，您确定吗？")&&$.getJSON("ajax_act_shake.php?action=reset",{roundno:CURR_ROUND},function(a){a.errno>0?nextRound():-2==a.errno?(alert("当前轮数无人参与、无法开始!"),window.location.reload()):(alert("重置失败啦"),window.location.reload())})})},tmr_cutdown_start,cutdown_start=function(){console.log("cutdown_start");var a=$(".cutdown-start"),b=1*SHAKE_INFO.ready_time+1;a.html("").show().css({"margin-left":-a.width()/2+"px","margin-top":-a.height()/2+"px","font-size":.7*a.height()+"px","line-height":a.height()+"px"}).addClass("cutdownan-imation"),tmr_cutdown_start=window.setInterval(function(){b--,0==b?(console.log("cutdown_start1"),$.getJSON("ajax_act_shake.php?action=start",{roundno:CURR_ROUND},function(b){if(b.errno>=0)a.html("GO!");else{if(-3==b.errno)return void setTimeout("gameTimeRun()",2e3);a.hide(),alert(b.message),window.location.reload()}}).fail(function(){alert("无法连接游戏服务器，请刷新重新开始"),window.location.reload()})):b<0?(window.clearInterval(tmr_cutdown_start),a.hide(),tmr_GameDataLoad=window.setInterval("gameTimeRun()",1500),showSlogan()):(audio_CutdownPlayer.play(),a.html(b))},1e3)},cutdown_startb=function(){console.log("cutdown_startb");var a=$(".cutdown-start"),b=1;a.html("").show().css({"margin-left":-a.width()/2+"px","margin-top":-a.height()/2+"px","font-size":.7*a.height()+"px","line-height":a.height()+"px"}).addClass("cutdownan-imation"),tmr_cutdown_start=window.setInterval(function(){b--,0==b?$.getJSON("ajax_act_shake.php?action=start",{roundno:CURR_ROUND},function(b){if(b.errno>=0)a.html("GO!");else{if(-3==b.errno)return void setTimeout("gameTimeRun()",2e3);a.hide(),alert(b.message),window.location.reload()}}).fail(function(){alert("无法连接游戏服务器，请刷新重新开始"),window.location.reload()}):b<0?(window.clearInterval(tmr_cutdown_start),a.hide(),tmr_GameDataLoad=window.setInterval("gameTimeRun()",1500),showSlogan()):(audio_CutdownPlayer.play(),a.html(b))},1e3)},roundTime,roundLength,nextRound=function(){if($(".result-layer").hide(),resethd(),-1==CURR_ROUND&&ROUND_COUNT>0||CURR_ROUND>=ROUND_COUNT)alert("轮次全部完成，直接显示中奖结果。"),$(".Panel.Track").hide(),showScore(),$(".frame-dialog .closebutton").hide();else if(0==ROUND_COUNT)alert("没有设置轮次");else{flgGameStop=!1,Players={},RanksPosition=[];for(var a=0;a<SHAKE_LINE;a++)RanksPosition[a]=0;roundTime=1e3*ROUNDS_LIST[CURR_ROUND].countdown,PlayStep=roundLength/(roundTime/tick>>0),$(".Panel.Track .tracklist").find(".player").remove(),$(".result-layer").hide().find(".player").remove(),$(".round-welcome").slideDown().find(".round-label").html("ROUND "+(CURR_ROUND+1)),2==ROUNDS_LIST[CURR_ROUND].status&&$(".round-welcome").slideUp(function(){cutdown_startb()})}},tmr_slogan;
//# sourceMappingURL=screen_paoma.js.map